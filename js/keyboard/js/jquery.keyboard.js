(function($){$.keyboard=function(el,options){var base=this,o;base.$el=$(el);base.el=el;base.$el.data("keyboard",base);base.init=function(){base.options=o=$.extend(true,{},$.keyboard.defaultOptions,options);base.shiftActive=base.altActive=base.metaActive=base.sets=base.capsLock=false;base.lastKeyset=[false,false,false];base.temp=['',0,0];base.rows=['','-shift','-alt','-alt-shift'];base.acceptedKeys=[];base.mappedKeys={};$('<!--[if lte IE 8]><script>$("body").addClass("oldie");</script><![endif]-->').appendTo('body').remove();base.msie=$('body').is('.oldie');base.opera=window.opera&&window.opera.toString()==='[object Opera]';base.inPlaceholder=base.$el.attr('placeholder')||'';base.watermark=(typeof(document.createElement('input').placeholder)!=='undefined'&&base.inPlaceholder!=='');base.regex=$.keyboard.comboRegex;base.decimal=(/^\./.test(o.display.dec))?true:false;base.checkCaret=(o.lockInput||base.msie||base.opera)?true:false;$.each('initialized visible change hidden canceled accepted beforeClose'.split(' '),function(i,f){if($.isFunction(o[f])){base.$el.bind(f+'.keyboard',o[f])}});if(o.alwaysOpen){o.stayOpen=true}if(!o.stayOpen){$(document).bind('mousedown.keyboard keyup.keyboard',function(e){if(base.isVisible&&(e.type==='mousedown'||(e.type==='keyup'&&e.which===27))){base.escClose(e)}})}base.$el.addClass('ui-keyboard-input ui-widget-content ui-corner-all').attr({'aria-haspopup':'true','role':'textbox'});if(base.$el.is(':disabled')||base.$el.attr('readonly')){base.$el.addClass('ui-keyboard-nokeyboard')}if(o.openOn){base.$el.bind(o.openOn+'.keyboard',function(){base.focusOn()})}if(!base.watermark&&base.$el.val()===''&&base.inPlaceholder!==''&&base.$el.attr('placeholder')!==''){base.$el.addClass('ui-keyboard-placeholder').val(base.inPlaceholder)}base.$el.trigger('initialized.keyboard',[base,base.el]);if(o.alwaysOpen){base.reveal()}};base.focusOn=function(){if(!base.isVisible||o.alwaysOpen){clearTimeout(base.timer);base.reveal();if(!o.usePreview){setTimeout(function(){base.preview.focus()},100)}}};base.reveal=function(){$('.ui-keyboard:not(.ui-keyboard-always-open)').hide();$('.ui-keyboard-has-focus').removeClass('ui-keyboard-has-focus');if(base.$el.is(':disabled')||base.$el.attr('readonly')){base.$el.addClass('ui-keyboard-nokeyboard');return}else{base.$el.removeClass('ui-keyboard-nokeyboard')}if(!o.usePreview){base.$el.unbind((o.openOn)?o.openOn+'.keyboard':'')}if(typeof(base.$keyboard)==='undefined'){base.startup()}if(!base.watermark&&base.el.value===base.inPlaceholder){base.$el.removeClass('ui-keyboard-placeholder').val('')}base.originalContent=base.$el.val();base.$preview.val(base.originalContent);var p,s,position=o.position;position.of=position.of||base.$el.data('keyboardPosition')||base.$el;position.collision=(o.usePreview)?position.collision||'fit fit':'flip flip';base.$keyboard.css({position:'absolute',left:0,top:0}).addClass('ui-keyboard-has-focus').show().position(position);if(typeof base.width==='undefined'){base.width=Math.ceil(base.$keyboard.width())}if(o.usePreview){base.$preview.width(base.width)}base.preview.focus();base.isVisible=true;base.checkDecimal();base.lineHeight=parseInt(base.$preview.css('lineHeight'),10)||parseInt(base.$preview.css('font-size'),10)+4;if(base.msie){s=base.originalContent.length;p={start:s,end:s};if(!base.lastCaret){base.lastCaret=p}if(base.lastCaret.end===0&&base.lastCaret.start>0){base.lastCaret.end=base.lastCaret.start}if(base.lastCaret.start<0){base.lastCaret=p}base.$preview.caret(base.lastCaret.start,base.lastCaret.end);$('<div class="ui-keyboard-overlay"></div>').click(function(){$(this).remove();base.close();return false}).appendTo('body');if(!o.usePreview){base.$el.addClass('ui-keyboard-overlay-input')}}base.$el.trigger('visible.keyboard',[base,base.el]);return base};base.startup=function(){base.$keyboard=base.buildKeyboard();base.$allKeys=base.$keyboard.find('.ui-keyboard-button');base.$preview=(o.usePreview)?base.$keyboard.find('.ui-keyboard-preview'):base.$el;base.preview=base.$preview[0];base.$decBtn=base.$keyboard.find('.ui-keyboard-dec');base.wheel=$.isFunction($.fn.mousewheel);base.alwaysAllowed=[20,33,34,35,36,37,38,39,40,45,46];base.lastCaret={start:0,end:0};base.$preview.bind('keypress.keyboard',function(e){var k=String.fromCharCode(e.charCode||e.which);if(base.checkCaret){base.lastCaret=base.$preview.caret()}base.capsLock=(((k>=65&&k<=90)&&!e.shiftKey)||((k>=97&&k<=122)&&e.shiftKey))?true:false;if(o.restrictInput){if((e.which===8||e.which===0)&&$.inArray(e.keyCode,base.alwaysAllowed)){return}if($.inArray(k,base.acceptedKeys)===-1){e.preventDefault()}}else if((e.ctrlKey||e.metaKey)&&(e.which===97||e.which===99||e.which===118||(e.which>=120&&e.which<=122))){return}if(base.hasMappedKeys){if(base.mappedKeys.hasOwnProperty(k)){base.insertText(base.mappedKeys[k]);e.preventDefault()}}base.checkMaxLength()}).bind('keyup.keyboard',function(e){switch(e.which){case 9:if(base.tab&&!o.lockInput){$.keyboard.keyaction.tab(base);base.tab=false}break;case 27:base.close();return false}clearTimeout(base.throttled);base.throttled=setTimeout(function(){base.checkCombos()},100);base.checkMaxLength();base.$el.trigger('change.keyboard',[base,base.el])}).bind('keydown.keyboard',function(e){switch(e.which){case 9:base.tab=true;e.preventDefault();break;case 13:if(e.shiftKey){base.close(true);return false}break;case 20:base.shiftActive=base.capsLock=!base.capsLock;base.showKeySet(this);break;case 86:if(e.ctrlKey||e.metaKey){if(o.preventPaste){e.preventDefault();return}base.checkCombos()}break}}).bind('mouseup.keyboard',function(){if(base.checkCaret){base.lastCaret=base.$preview.caret()}}).bind('blur.keyboard',function(e){if(o.alwaysOpen){clearTimeout(base.timer);base.timer=setTimeout(function(){if($(':focus')[0]!==base.el){base.close(o.autoAccept)}},300)}});if(o.preventPaste){base.$preview.bind('contextmenu.keyboard',function(e){e.preventDefault()});base.$el.bind('contextmenu.keyboard',function(e){e.preventDefault()})}base.$keyboard.appendTo('body');base.$allKeys.bind(o.keyBinding+'.keyboard',function(e){var txt,key=$.data(this,'key'),action=key.action.split(':')[0];base.preview.focus();if(base.checkCaret){base.$preview.caret(base.lastCaret.start,base.lastCaret.end)}if(action.match('meta')){action='meta'}if($.keyboard.keyaction.hasOwnProperty(action)&&$(this).is('.ui-keyboard-actionkey')){if($.keyboard.keyaction[action](base,this)===false){return}}else if(typeof key.action!=='undefined'){txt=(base.wheel&&!$(this).is('.ui-keyboard-actionkey'))?key.curTxt:key.action;base.insertText(txt);if(!base.capsLock&&!o.stickyShift&&!e.shiftKey){base.shiftActive=false;base.showKeySet(this)}}base.checkCombos();base.checkMaxLength();base.$el.trigger('change.keyboard',[base,base.el]);if(o.usePreview){base.preview.focus()}e.preventDefault()}).bind('mouseenter.keyboard mouseleave.keyboard',function(e){var el=this,$this=$(this),key=$.data(el,'key');if(e.type==='mouseenter'&&base.el.type!=='password'){$this.addClass('ui-state-hover').attr('title',function(i,t){return(base.wheel&&t===''&&base.sets)?o.wheelMessage:t})}if(e.type==='mouseleave'){key.curTxt=key.original;key.curNum=0;$.data(el,'key',key);$this.removeClass((base.el.type==='password')?'':'ui-state-hover').attr('title',function(i,t){return(t===o.wheelMessage)?'':t}).find('span').text(key.original)}}).bind('mousewheel.keyboard',function(e,delta){if(base.wheel){var txt,$this=$(this),key=$.data(this,'key');txt=key.layers||base.getLayers($this);key.curNum+=(delta>0)?-1:1;if(key.curNum>txt.length-1){key.curNum=0}if(key.curNum<0){key.curNum=txt.length-1}key.layers=txt;key.curTxt=txt[key.curNum];$.data(this,'key',key);$this.find('span').text(txt[key.curNum]);return false}}).bind('mouseup.keyboard',function(){base.preview.focus()})};base.insertText=function(txt){var bksp,t,h,val=base.$preview.val(),pos=base.$preview.caret(),scrL=base.$preview.scrollLeft(),scrT=base.$preview.scrollTop(),len=val.length;if(pos.end<pos.start){pos.end=pos.start}if(pos.start>len){pos.end=pos.start=len}if(base.preview.tagName==='TEXTAREA'){if(base.msie&&val.substr(pos.start,1)==='\n'){pos.start+=1;pos.end+=1}h=(val.split('\n').length-1);base.preview.scrollTop=(h>0)?base.lineHeight*h:scrT}bksp=(txt==='bksp'&&pos.start===pos.end)?true:false;txt=(txt==='bksp')?'':txt;t=pos.start+(bksp?-1:txt.length);scrL+=parseInt(base.$preview.css('fontSize'),10)*(txt==='bksp'?-1:1);base.$preview.val(base.$preview.val().substr(0,pos.start-(bksp?1:0))+txt+base.$preview.val().substr(pos.end)).caret(t,t).scrollLeft(scrL);if(base.checkCaret){base.lastCaret={start:t,end:t}}};base.checkMaxLength=function(){var t,p=base.$preview.val();if(o.maxLength!==false&&p.length>o.maxLength){t=Math.min(base.$preview.caret().start,o.maxLength);base.$preview.val(p.substring(0,o.maxLength));base.$preview.caret(t,t);base.lastCaret={start:t,end:t}}if(base.$decBtn.length){base.checkDecimal()}};base.showKeySet=function(el){var key='',toShow=(base.shiftActive?1:0)+(base.altActive?2:0);if(!base.shiftActive){base.capsLock=false}if(base.metaActive){key=(el&&el.name&&/meta/.test(el.name))?el.name:'';if(key===''){key=(base.metaActive===true)?'':base.metaActive}else{base.metaActive=key}if((!o.stickyShift&&base.lastKeyset[2]!==base.metaActive)||((base.shiftActive||base.altActive)&&!base.$keyboard.find('.ui-keyboard-keyset-'+key+base.rows[toShow]).length)){base.shiftActive=base.altActive=false}}else if(!o.stickyShift&&base.lastKeyset[2]!==base.metaActive&&base.shiftActive){base.shiftActive=base.altActive=false}toShow=(base.shiftActive?1:0)+(base.altActive?2:0);key=(toShow===0&&!base.metaActive)?'-default':(key==='')?'':'-'+key;if(!base.$keyboard.find('.ui-keyboard-keyset'+key+base.rows[toShow]).length){base.shiftActive=base.lastKeyset[0];base.altActive=base.lastKeyset[1];base.metaActive=base.lastKeyset[2];return}base.$keyboard.find('.ui-keyboard-alt, .ui-keyboard-shift, .ui-keyboard-actionkey[class*=meta]').removeClass(o.actionClass).end().find('.ui-keyboard-alt')[(base.altActive)?'addClass':'removeClass'](o.actionClass).end().find('.ui-keyboard-shift')[(base.shiftActive)?'addClass':'removeClass'](o.actionClass).end().find('.ui-keyboard-lock')[(base.capsLock)?'addClass':'removeClass'](o.actionClass).end().find('.ui-keyboard-keyset').hide().end().find('.ui-keyboard-keyset'+key+base.rows[toShow]).show().end().find('.ui-keyboard-actionkey.ui-keyboard'+key).addClass(o.actionClass);base.lastKeyset=[base.shiftActive,base.altActive,base.metaActive]};base.checkCombos=function(){var i,r,t,val=base.$preview.val(),pos=base.$preview.caret(),len=val.length;if(pos.end<pos.start){pos.end=pos.start}if(pos.start>len){pos.end=pos.start=len}if(base.msie&&val.substr(pos.start,1)==='\n'){pos.start+=1;pos.end+=1}if(o.useCombos){val=val.replace(base.regex,function(s,accent,letter){return(o.combos.hasOwnProperty(accent))?o.combos[accent][letter]||s:s})}if(o.restrictInput){t=val.split('');r=t.length;for(i=0;i<r;i++){if($.inArray(t[i],base.acceptedKeys)<0){val=val.replace(t[i],'')}}}pos.start+=val.length-len;pos.end+=val.length-len;base.$preview.val(val);base.$preview.caret(pos.start,pos.end);base.preview.scrollTop=base.lineHeight*(val.substring(0,pos.start).split('\n').length-1);base.lastCaret={start:pos.start,end:pos.end};return val};base.checkDecimal=function(){if((base.decimal&&/\./g.test(base.preview.value))||(!base.decimal&&/\,/g.test(base.preview.value))){base.$decBtn.attr({'disabled':'disabled','aria-disabled':'true'}).removeClass('ui-state-default ui-state-hover').addClass('ui-state-disabled')}else{base.$decBtn.removeAttr('disabled').attr({'aria-disabled':'false'}).addClass('ui-state-default').removeClass('ui-state-disabled')}};base.getLayers=function(el){var key,keys;key=el.attr('data-pos');keys=el.closest('.ui-keyboard').find('button[data-pos="'+key+'"]').map(function(){return $(this).find('span').text()}).get();return keys};base.close=function(accepted){if(base.$keyboard.is(':visible')){clearTimeout(base.throttled);base.$el.trigger((o.alwaysOpen)?'':'beforeClose.keyboard',[base,base.el,(accepted||false)]).val((accepted)?(o.alwaysOpen?base.$el.val():base.checkCombos()):base.originalContent).scrollTop(base.el.scrollHeight).trigger(((accepted||false)?'accepted.keyboard':'canceled.keyboard'),[base,base.el]).trigger((o.alwaysOpen)?'':'hidden.keyboard',[base,base.el]).removeClass('ui-keyboard-overlay-input');if(!o.usePreview&&o.openOn!==''){base.$el.bind(o.openOn+'.keyboard',function(){base.focusOn()})}$('.ui-keyboard-overlay').remove();if(!o.alwaysOpen){base.$keyboard.hide();base.isVisible=false}if(!base.watermark&&base.el.value===''&&base.inPlaceholder!==''){base.$el.addClass('ui-keyboard-placeholder').val(base.inPlaceholder)}}return false};base.accept=function(){base.close(true)};base.escClose=function(e){if(e.target===base.el){return}if(!$(e.target).closest('.ui-keyboard').length){base.close((o.autoAccept)?true:false)}if(base.msie){e.preventDefault()}};base.keyBtn=$('<button />').attr({'role':'button','aria-disabled':'false'}).addClass('ui-keyboard-button ui-state-default ui-corner-all');base.addKey=function(keyName,name,regKey){var t,keyType,m,map,nm,n=(regKey===true)?keyName:o.display[name]||keyName,kn=(regKey===true)?keyName.charCodeAt(0):keyName;if(/\(.+\)/.test(n)){map=n.replace(/\(([^()]+)\)/,'');m=n.match(/\(([^()]+)\)/)[1];n=map;nm=map.split(':');map=(nm[0]!==''&&nm.length>1)?nm[0]:map;base.mappedKeys[m]=map}nm=n.split(':');if(nm[0]===''&&nm[1]===''){n=':'}n=(nm[0]!==''&&nm.length>1)?$.trim(nm[0]):n;t=(nm.length>1)?$.trim(nm[1]).replace(/_/g," ")||'':'';keyType=(n.length>1)?' ui-keyboard-widekey':'';keyType+=(regKey)?'':' ui-keyboard-actionkey';return base.keyBtn.clone().attr({'data-value':n,'name':kn,'data-pos':base.temp[1]+','+base.temp[2],'title':t}).data('key',{action:keyName,original:n,curTxt:n,curNum:0}).addClass('ui-keyboard-'+kn+keyType).html('<span>'+n+'</span>').appendTo(base.temp[0])};base.buildKeyboard=function(){var action,row,newSet,currentSet,key,keys,margin,sets=0,container=$('<div />').addClass('ui-keyboard ui-widget-content ui-widget ui-corner-all ui-helper-clearfix'+(o.alwaysOpen?' ui-keyboard-always-open':'')).attr({'role':'textbox'}).hide();if(o.usePreview){base.$preview=base.$el.clone(false).removeAttr('id').removeAttr('placeholder').removeClass('ui-keyboard-placeholder').addClass('ui-widget-content ui-keyboard-preview ui-corner-all').show()}else{base.$preview=base.$el;o.position.at=o.position.at2}base.$preview.attr((o.lockInput)?{'readonly':'readonly'}:{});if(o.usePreview){$('<div />').append(base.$preview).appendTo(container)}if(o.layout==='custom'||!$.keyboard.layouts.hasOwnProperty(o.layout)){o.layout='custom';$.keyboard.layouts.custom=o.customLayout||{'default':['{cancel}']}}$.each($.keyboard.layouts[o.layout],function(set,keySet){if(set!==""){sets++;newSet=$('<div />').attr('name',set).addClass('ui-keyboard-keyset ui-keyboard-keyset-'+set).appendTo(container)[(set==='default')?'show':'hide']();for(row=0;row<keySet.length;row++){currentSet=$.trim(keySet[row]).replace(/\{(\.?)[\s+]?:[\s+]?(\.?)\}/g,'{$1:$2}');keys=currentSet.split(/\s+/);for(key=0;key<keys.length;key++){base.temp=[newSet,row,key];if(keys[key].length===0){continue}if(/^\{\S+\}$/.test(keys[key])){action=keys[key].match(/^\{(\S+)\}$/)[1].toLowerCase();if(/^sp:(\.?\d+)$/.test(action)){margin=action.match(/^sp:(\.?\d+)$/)[1]||0;$('<span>&nbsp;</span>').css('margin','0 '+margin+'em').appendTo(newSet)}if(/^meta\d+\:?(\w+)?/.test(action)){base.addKey(action,action);continue}switch(action){case'a':case'accept':base.addKey('accept',action).addClass(o.actionClass);break;case'alt':case'altgr':base.addKey('alt','alt');break;case'b':case'bksp':base.addKey('bksp',action);break;case'c':case'cancel':base.addKey('cancel',action).addClass(o.actionClass);break;case'combo':base.addKey('combo','combo').addClass(o.actionClass);break;case'dec':base.acceptedKeys.push((base.decimal)?'.':',');base.addKey('dec','dec');break;case'e':case'enter':base.addKey('enter',action).addClass(o.actionClass);break;case's':case'shift':base.addKey('shift',action);break;case'sign':base.acceptedKeys.push('-');base.addKey('sign','sign');break;case'space':base.acceptedKeys.push(' ');base.addKey('space','&nbsp;');break;case't':case'tab':base.addKey('tab',action);break;default:if($.keyboard.keyaction.hasOwnProperty(action)){base.addKey(action,action)}}}else{base.acceptedKeys.push(keys[key].split(':')[0]);base.addKey(keys[key],keys[key],true)}}newSet.find('.ui-keyboard-button:last').after('<br class="ui-keyboard-button-endrow">')}}});if(sets>1){base.sets=true}base.hasMappedKeys=!($.isEmptyObject(base.mappedKeys));return container};base.destroy=function(){$(document).unbind('mousedown.keyboard keyup.keyboard',base.escClose);if(base.$keyboard){base.$keyboard.remove()}var unb=o.openOn+' accepted beforeClose blur canceled change contextmenu hidden initialized keydown keypress keyup visible'.split(' ').join('.keyboard ');base.$el.removeClass('ui-keyboard-input ui-widget-content ui-corner-all ui-keyboard-placeholder ui-keyboard-notallowed ui-keyboard-always-open').removeAttr('aria-haspopup').removeAttr('role').unbind(unb+'.keyboard').removeData('keyboard')};base.init()};$.keyboard.keyaction={accept:function(base){base.close(true);return false},alt:function(base,el){base.altActive=!base.altActive;base.showKeySet(el)},bksp:function(base){base.insertText('bksp')},cancel:function(base){base.close();return false},clear:function(base){base.$preview.val('')},combo:function(base){var c=!base.options.useCombos;base.options.useCombos=c;base.$keyboard.find('.ui-keyboard-combo')[(c)?'addClass':'removeClass'](base.options.actionClass);if(c){base.checkCombos()}return false},dec:function(base){base.insertText((base.decimal)?'.':',')},enter:function(base){if(base.el.tagName==='INPUT'){return}base.insertText('\r\n')},lock:function(base,el){base.lastKeyset[0]=base.shiftActive=base.capsLock=!base.capsLock;base.showKeySet(el)},meta:function(base,el){base.metaActive=($(el).is('.'+base.options.actionClass))?false:true;base.showKeySet(el)},shift:function(base,el){base.lastKeyset[0]=base.shiftActive=!base.shiftActive;base.showKeySet(el)},sign:function(base){if(/^\-?\d*\.?\d*$/.test(base.$preview.val())){base.$preview.val((base.$preview.val()*-1))}},space:function(base){base.insertText(' ')},tab:function(base){if(base.el.tagName==='INPUT'){return}base.insertText('\t')}};$.keyboard.layouts={'alpha':{'default':['` 1 2 3 4 5 6 7 8 9 0 - = {bksp}','{tab} a b c d e f g h i j [ ] \\','k l m n o p q r s ; \' {enter}','{shift} t u v w x y z , . / {shift}','{accept} {space} {cancel}'],'shift':['~ ! @ # $ % ^ & * ( ) _ + {bksp}','{tab} A B C D E F G H I J { } |','K L M N O P Q R S : " {enter}','{shift} T U V W X Y Z < > ? {shift}','{accept} {space} {cancel}']},'qwerty':{'default':['` 1 2 3 4 5 6 7 8 9 0 - = {bksp}','{tab} q w e r t y u i o p [ ] \\','a s d f g h j k l ; \' {enter}','{shift} z x c v b n m , . / {shift}','{accept} {space} {cancel}'],'shift':['~ ! @ # $ % ^ & * ( ) _ + {bksp}','{tab} Q W E R T Y U I O P { } |','A S D F G H J K L : " {enter}','{shift} Z X C V B N M < > ? {shift}','{accept} {space} {cancel}']},'international':{'default':['` 1 2 3 4 5 6 7 8 9 0 - = {bksp}','{tab} q w e r t y u i o p [ ] \\','a s d f g h j k l ; \' {enter}','{shift} z x c v b n m , . / {shift}','{accept} {alt} {space} {alt} {cancel}'],'shift':['~ ! @ # $ % ^ & * ( ) _ + {bksp}','{tab} Q W E R T Y U I O P { } |','A S D F G H J K L : " {enter}','{shift} Z X C V B N M < > ? {shift}','{accept} {alt} {space} {alt} {cancel}'],'alt':['~ \u00a1 \u00b2 \u00b3 \u00a4 \u20ac \u00bc \u00bd \u00be \u2018 \u2019 \u00a5 \u00d7 {bksp}','{tab} \u00e4 \u00e5 \u00e9 \u00ae \u00fe \u00fc \u00fa \u00ed \u00f3 \u00f6 \u00ab \u00bb \u00ac','\u00e1 \u00df \u00f0 f g h j k \u00f8 \u00b6 \u00b4 {enter}','{shift} \u00e6 x \u00a9 v b \u00f1 \u00b5 \u00e7 > \u00bf {shift}','{accept} {alt} {space} {alt} {cancel}'],'alt-shift':['~ \u00b9 \u00b2 \u00b3 \u00a3 \u20ac \u00bc \u00bd \u00be \u2018 \u2019 \u00a5 \u00f7 {bksp}','{tab} \u00c4 \u00c5 \u00c9 \u00ae \u00de \u00dc \u00da \u00cd \u00d3 \u00d6 \u00ab \u00bb \u00a6','\u00c4 \u00a7 \u00d0 F G H J K \u00d8 \u00b0 \u00a8 {enter}','{shift} \u00c6 X \u00a2 V B \u00d1 \u00b5 \u00c7 . \u00bf {shift}','{accept} {alt} {space} {alt} {cancel}']},'dvorak':{'default':['` 1 2 3 4 5 6 7 8 9 0 [ ] {bksp}','{tab} \' , . p y f g c r l / = \\','a o e u i d h t n s - {enter}','{shift} ; q j k x b m w v z {shift}','{accept} {space} {cancel}'],'shift':['~ ! @ # $ % ^ & * ( ) { } {bksp}','{tab} " < > P Y F G C R L ? + |','A O E U I D H T N S _ {enter}','{shift} : Q J K X B M W V Z {shift}','{accept} {space} {cancel}']},'num':{'default':['= ( ) {b}','{clear} / * -','7 8 9 +','4 5 6 {sign}','1 2 3 %','0 . {a} {c}']}};$.keyboard.defaultOptions={layout:'qwerty',customLayout:null,position:{of:null,my:'center top',at:'center top',at2:'center bottom'},usePreview:true,alwaysOpen:false,stayOpen:false,display:{'a':'\u2714:Accept (Shift-Enter)','accept':'Accept:Accept (Shift-Enter)','alt':'AltGr:Alternate Graphemes','b':'\u2190:Backspace','bksp':'Bksp:Backspace','c':'\u2716:Cancel (Esc)','cancel':'Cancel:Cancel (Esc)','clear':'C:Clear','combo':'\u00f6:Toggle Combo Keys','dec':'.:Decimal','e':'\u21b5:Enter','enter':'Enter:Enter','lock':'\u21ea Lock:Caps Lock','s':'\u21e7:Shift','shift':'Shift:Shift','sign':'\u00b1:Change Sign','space':' :Space','t':'\u21e5:Tab','tab':'\u21e5 Tab:Tab'},wheelMessage:'Use mousewheel to see other keys',actionClass:'ui-state-active',autoAccept:false,lockInput:false,restrictInput:false,stickyShift:true,preventPaste:false,maxLength:false,openOn:'focus',keyBinding:'mousedown',useCombos:true,combos:{'`':{a:"\u00e0",A:"\u00c0",e:"\u00e8",E:"\u00c8",i:"\u00ec",I:"\u00cc",o:"\u00f2",O:"\u00d2",u:"\u00f9",U:"\u00d9",y:"\u1ef3",Y:"\u1ef2"},"'":{a:"\u00e1",A:"\u00c1",e:"\u00e9",E:"\u00c9",i:"\u00ed",I:"\u00cd",o:"\u00f3",O:"\u00d3",u:"\u00fa",U:"\u00da",y:"\u00fd",Y:"\u00dd"},'"':{a:"\u00e4",A:"\u00c4",e:"\u00eb",E:"\u00cb",i:"\u00ef",I:"\u00cf",o:"\u00f6",O:"\u00d6",u:"\u00fc",U:"\u00dc",y:"\u00ff",Y:"\u0178"},'^':{a:"\u00e2",A:"\u00c2",e:"\u00ea",E:"\u00ca",i:"\u00ee",I:"\u00ce",o:"\u00f4",O:"\u00d4",u:"\u00fb",U:"\u00db",y:"\u0177",Y:"\u0176"},'~':{a:"\u00e3",A:"\u00c3",e:"\u1ebd",E:"\u1ebc",i:"\u0129",I:"\u0128",o:"\u00f5",O:"\u00d5",u:"\u0169",U:"\u0168",y:"\u1ef9",Y:"\u1ef8",n:"\u00f1",N:"\u00d1"}},initialized:null,accepted:null,canceled:null,hidden:null,visible:null,beforeClose:null};$.keyboard.comboRegex=/([`\'~\^\"ao])([a-z])/mig;$.fn.keyboard=function(options){return this.each(function(){(new $.keyboard(this,options))})};$.fn.getkeyboard=function(){return this.data("keyboard")}})(jQuery);(function($,len,createRange,duplicate){$.fn.caret=function(options,opt2){if(typeof this[0]==='undefined'){return}var n,s,start,e,end,selRange,range,stored_range,te,val,selection=document.selection,t=this[0],sTop=t.scrollTop,opera=window.opera&&window.opera.toString()==='[object Opera]',ss=typeof t.selectionStart!=='undefined';if(typeof options==='number'&&typeof opt2==='number'){start=options;end=opt2}if(typeof start!=='undefined'){if(ss){if(t.tagName==='TEXTAREA'&&opera){val=this.val();n=val.substring(0,start).split('\n')[len]-1;start+=(n>0)?n:0;end+=(n>0)?n:0}t.selectionStart=start;t.selectionEnd=end}else{selRange=t.createTextRange();selRange.collapse(true);selRange.moveStart('character',start);selRange.moveEnd('character',end-start);selRange.select()}t.focus();t.scrollTop=sTop;return this}else{if(ss){s=t.selectionStart;e=t.selectionEnd;if(t.tagName==='TEXTAREA'&&opera){val=this.val();n=val.substring(0,s).split('\n')[len]-1;s+=(n>0)?-n:0;e+=(n>0)?-n:0}}else{if(t.tagName==='TEXTAREA'){val=this.val();range=selection[createRange]();stored_range=range[duplicate]();stored_range.moveToElementText(t);stored_range.setEndPoint('EndToEnd',range);s=stored_range.text.replace(/\r\n/g,'\r')[len];e=s+range.text.replace(/\r\n/g,'\r')[len]}else{val=this.val().replace(/\r\n/g,'\r');range=selection[createRange]()[duplicate]();range.moveEnd('character',val[len]);s=(range.text===''?val[len]:val.lastIndexOf(range.text));range=selection[createRange]()[duplicate]();range.moveStart('character',-val[len]);e=range.text[len]}}te=t.value.substring(s,e);return{start:s,end:e,text:te,replace:function(st){return t.value.substring(0,s)+st+t.value.substring(e,t.value[len])}}}}})(jQuery,'length','createRange','duplicate');